[DEFAULT]
; Enhanced configuration file for LiFePO4 batteries in parallel

LINEAR_LIMITATION_ENABLE = True
MAX_BATTERY_CHARGE_CURRENT = 100.0
MAX_BATTERY_DISCHARGE_CURRENT = 120.0

; Bluetooth Watchdog settings (longer timeout for parallel connections)
BT_WATCHDOG_TIMEOUT = 90
BT_WATCHDOG_ACTION = log

; -------- Cell Voltage limitation ---------
CCCM_CV_ENABLE = True
DCCM_CV_ENABLE = True

; Adjusted for LiFePO4 cells with balanced charge tapering
CELL_VOLTAGES_WHILE_CHARGING   = 3.55, 3.50, 3.45, 3.40, 3.30
MAX_CHARGE_CURRENT_CV_FRACTION = 0.0,  0.05, 0.25, 0.75, 1.0

; LiFePO4 discharge limits with more gradual tapering
CELL_VOLTAGES_WHILE_DISCHARGING   = 2.50, 2.80, 2.90, 3.10
MAX_DISCHARGE_CURRENT_CV_FRACTION = 0.0,  0.20, 0.60, 1.00

; -------- Temperature limitation ---------
; Enable temperature-based current limiting
CCCM_T_ENABLE = True
DCCM_T_ENABLE = True

; More conservative temperature limits for parallel batteries
TEMPERATURE_LIMITS_WHILE_CHARGING = 0, 2  , 5,   8  ,  10  , 15, 20, 35, 40   , 50
MAX_CHARGE_CURRENT_T_FRACTION =     0, 0.1, 0.3, 0.6,  0.8,  1,  1,  0.6,  0.2 ,  0

; Discharge temperature limits
TEMPERATURE_LIMITS_WHILE_DISCHARGING = -10, 0, 5, 10, 15, 40, 50
MAX_DISCHARGE_CURRENT_T_FRACTION =      0, 0.2, 0.4, 0.6, 1, 0.6, 0

; Voltage penalty settings for cell voltage management
PENALTY_AT_CELL_VOLTAGE = 3.45, 3.50, 3.55
PENALTY_BATTERY_VOLTAGE = 0.01, 0.1, 0.3

; -------- Cell Voltage settings for LiFePO4 ---------
MIN_CELL_VOLTAGE = 2.5
MAX_CELL_VOLTAGE = 3.55
FLOAT_CELL_VOLTAGE = 3.40
MAX_VOLTAGE_TIME_SEC = 1800
SOC_LEVEL_TO_RESET_VOLTAGE_LIMIT = 95

; -------- SOC limitation for parallel batteries ---------
; Enable SOC-based current limiting for charging but not discharge
CCCM_SOC_ENABLE = True
DCCM_SOC_ENABLE = False

; Adjusted charge tapering thresholds
CC_SOC_LIMIT1 = 95
CC_SOC_LIMIT2 = 90
CC_SOC_LIMIT3 = 80

; Charge current limits (fraction of max)
CC_CURRENT_LIMIT1_FRACTION = 0.1
CC_CURRENT_LIMIT2_FRACTION = 0.3
CC_CURRENT_LIMIT3_FRACTION = 0.7

; Discharge current SOC limits
DC_SOC_LIMIT1 = 5
DC_SOC_LIMIT2 = 10
DC_SOC_LIMIT3 = 20

; Discharge current limits (fraction of max)
DC_CURRENT_LIMIT1_FRACTION = 0.3
DC_CURRENT_LIMIT2_FRACTION = 0.5
DC_CURRENT_LIMIT3_FRACTION = 0.7

; Enable voltage management
CVCM_ENABLE = True

; Enable midpoint monitoring
MIDPOINT_ENABLE = True

; SOC low levels
SOC_LOW_WARNING = 10
SOC_LOW_ALARM = 5

; Battery capacity (Ah) fallback if BMS doesn't provide it
BATTERY_CAPACITY = 100

; Set to -1 to invert current measurement if needed
INVERT_CURRENT_MEASUREMENT = 1

; TimeToSoC points (SoC levels for which time predictions are made)
TIME_TO_SOC_POINTS = 100, 90, 80, 50, 20, 10, 0

; TimeToSoC display format (3 = both seconds and time string)
TIME_TO_SOC_VALUE_TYPE = 3

; Update frequency for TimeToSoc values
TIME_TO_SOC_LOOP_CYCLES = 5

; Include predictions when moving away from point
TIME_TO_SOC_INC_FROM = False

; Cell data format (1 = dbus path format /Voltages/Cell#)
BATTERY_CELL_DATA_FORMAT = 1

; Publish config values to DBUS
PUBLISH_CONFIG_VALUES = 1

; Default BMS type
BMS_TYPE = JBD